{% extends 'base.html' %}

{% block app_content %}
<h1>Temperature sensor setup</h1>
<form action="" method="post">
    {{ form.hidden_tag() }}



    <table class="table table-striped table-hover">
        <thead class="thead-light">
            <tr valign="top">
                <th>Sensor</th>
                <th>Id</th>
                <th>Name</th>
                <th>Temperature</th>
            </tr>
        </thead>

        <tr valign="top">
            <td>{{ form.t0.label }}</td>
            <td>{{ form.t0(cols=60, onchange="checkDuplicates('t0')") }}</td>
            <td>Internal</td>
            <td id="t0_temp"></td>
        </tr>

        <tr valign="top">
            <td>{{ form.t1.label }}</td>
            <td>{{ form.t1(cols=60, onchange="checkDuplicates('t1')") }}</td>
            <td>{{ form.t1_name(cols=50) }}</td>
            <td id="t1_temp"></td>
        </tr>

        <tr valign="top">
            <td>{{ form.t2.label }}</td>
            <td>{{ form.t2(cols=60, onchange="checkDuplicates('t2')") }}</td>
            <td>{{ form.t2_name(cols=50) }}</td>
            <td id="t2_temp"></td>
        </tr>

        <tr valign="top">
            <td>{{ form.t3.label }}</td>
            <td>{{ form.t3(cols=60, onchange="checkDuplicates('t3')") }}</td>
            <td>{{ form.t3_name(cols=50) }}</td>
            <td id="t3_temp"></td>
        </tr>

        <tr valign="top">
            <td>{{ form.t4.label }}</td>
            <td>{{ form.t4(cols=60, onchange="checkDuplicates('t4')") }}</td>
            <td>{{ form.t4_name(cols=50) }}</td>
            <td id="t4_temp"></td>
        </tr>

    </table>

    <p>{{ form.submit() }}</p>
</form>

<b>Sensors</b>
<table class="table table-striped table-hover">
    <thead class="thead-light">
        <tr valign="top">
            <th>Id</th>
            <th>Temperature</th>
        </tr>
    </thead>
    {% for sensor in sensors %}
        {% include 'settings/_tempsens.html' %}
    {% endfor %}    

</table>
{% endblock %}

{% block scripts %}
{{super()}}
<script>
    function checkDuplicates(src){
        var e = document.getElementById(src);
        var val = e.options[e.selectedIndex].value;
        if (val != "none"){
            if (src != "t0"){
                var _e = document.getElementById("t0");
                var _val = _e.options[_e.selectedIndex].value;
                if (_val == val){
                    _e.value = "none";
                }
            }
            if (src != "t1"){
                var _e = document.getElementById("t1");
                var _val = _e.options[_e.selectedIndex].value;
                if (_val == val){
                    _e.value = "none";
                }
            }
            if (src != "t2"){
                var _e = document.getElementById("t2");
                var _val = _e.options[_e.selectedIndex].value;
                if (_val == val){
                    _e.value = "none";
                }
            }
            if (src != "t3"){
                var _e = document.getElementById("t3");
                var _val = _e.options[_e.selectedIndex].value;
                if (_val == val){
                    _e.value = "none";
                }
            }
            if (src != "t4"){
                var _e = document.getElementById("t4");
                var _val = _e.options[_e.selectedIndex].value;
                if (_val == val){
                    _e.value = "none";
                }
            }
        }
    }
    function get_data(){ 
        $.getJSON("/data/rawtemp", function (data, status){
            $.each(data, function(i, item) {
                document.getElementById(item.id).innerHTML = item.data.value
                if (document.getElementById("t0").options[_e.selectedIndex].value == item.id){
                    document.getElementById(t0_temp).innerHTML = item.data.value
                }
            });
        });
    }
    get_data();
    setInterval(get_data, 5000);

</script>

{% endblock %}